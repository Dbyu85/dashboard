{"changed":true,"filter":false,"title":"graph.js","tooltip":"/static/js/graph.js","value":"queue()\n    .defer(d3.csv, \"data/Salaries.csv\")\n    .await(makeGraphs)\n\nfunction makeGraphs(error, salaryData) {\n    var ndx = crossfilter(salaryData);\n\n    salaryData.forEach(function(d) {\n        d.salary = parseInt(d.salary);\n    })\n\n    show_discipline_selector(ndx);\n    show_percent_that_are_professors(ndx, 'Female', '#percentage-of-women-profesors');\n    show_percent_that_are_professors(ndx, 'Male', '#percentage-of-men-profesors');\n\n    show_gender_balance(ndx);\n    show_average_salary(ndx);\n    show_rank_distribution(ndx);\n\n    dc.renderAll();\n}\n\nfunction show_discipline_selector(ndx) {\n    dim = ndx.dimension(dc.pluck('discipline'));\n    group = dim.group();\n\n    dc.selectMenu('#discipline-selector')\n        .dimension(dim)\n        .group(group);\n}\n\nfunction show_percent_that_are_professors(ndx, gender, element) {\n    var percentageThatAreProfessors = ndx.groupAll().reduce(\n        function(p, v) {\n            p.total++;\n            if (v.sex === gender) {\n                p.count++;\n                if (v.rank === 'prof') {\n                    p.are_prof++;\n                }\n            }\n            return p;\n        },\n        function(p, v) {\n            p.total--\n                if (v.sex === gender) {\n                    p.count--\n                        if (v.rank === 'prof') {\n                            p.are_prof--\n                        }\n                }\n            return p;\n        },\n        function() {\n            return (total = 0, match = 0);\n        }\n    );\n    dc.numberDisplay(element)\n        .formatNumber(d3.format('.2%'))\n        .valueAccessor(function(d) {\n            if (d.count == 0) {\n                return 0;\n            }\n            else {\n                return (d.are_prof / d.count);\n            }\n        })\n        .group(percentageThatAreProfessors)\n\n}\n\n\nfunction show_gender_balance(ndx) {\n    var dim = ndx.dimension(dc.pluck('sex'));\n    var group = dim.group();\n\n    dc.barChart('#gender-balance')\n        .width(400)\n        .height(300)\n        .margins({ top: 10, right: 50, bottom: 30, left: 50 })\n        .dimension(dim)\n        .group(group)\n        .transitionDuration(500)\n        .x(d3.scale.ordinal())\n        .xUnits(dc.units.ordinal)\n\n        .xAxisLabel('Gender')\n        .yAxis().ticks(20);\n\n}\n\nfunction show_average_salary(ndx) {\n    var dim = ndx.dimension(dc.pluck('sex'));\n\n    function add_item(p, v) {\n        p.count++;\n        p.total += v.salary;\n        p.average = p.total / p.count;\n        return p;\n    }\n\n    function remove_item(p, v) {\n        p.count--;\n        if (p.count == 0) {\n            p.total = 0;\n            p.average = 0;\n        }\n        else {\n            p.total -= v.salary;\n            p.average = p.total / p.count;\n        }\n        return p;\n\n\n    }\n\n    function initialise() {\n        return { count: 0, total: 0, average: 0 };\n\n    }\n\n    var averageSalaryByGender = dim.group().reduce(add_item, remove_item, initialise);\n\n    dc.barChart('#average-salary')\n        .width(400)\n        .height(300)\n        .margins({ top: 10, right: 50, bottom: 30, left: 50 })\n        .dimension(dim)\n        .group(averageSalaryByGender)\n        .valueAccessor(function(d) {\n            return d.value.average.toFixed(2);\n        })\n        .transitionDuration(500)\n        .x(d3.scale.ordinal())\n        .xUnits(dc.units.ordinal)\n        .elasticY(true)\n        .xAxisLabel('Gender')\n        .yAxis().ticks(4);\n}\n\nfunction show_rank_distribution(ndx) {\n\n    function rankByGender(dimension, rank) {\n\n        return dimension.group().reduce(\n            function(p, v) {\n                p.total++;\n                if (v.rank == rank) {\n                    p.match++;\n                }\n                return p;\n            },\n            function(p, v) {\n                p.total--;\n                if (v.rank == rank) {\n                    p.match--;\n                }\n                return p;\n            },\n            function() {\n                return (total = 0, match = 0);\n            }\n        );\n    }\n\n    var dim = ndx.dimension(dc.pluck('sex'));\n    var profByGender = rankByGender(dim, 'Prof');\n    var asstProfByGender = rankByGender(dim, 'AssProf');\n    var assocProfByGender = rankByGender(dim, 'AssocProf');\n\n    dc.barChart('#rank-distribution')\n        .width(400)\n        .height(300)\n        .dimension(dim)\n        .group(profByGender, 'Prof')\n        .stack(asstProfByGender, 'Asst Prof')\n        .stack(assocProfByGender, 'Assoc Prof')\n        .valueAccessor(function(d) {\n            if (d.value.total > 0) {\n                return (d.value.match / d.value.total) * 100;\n            }\n            else {\n                return 0;\n            }\n        })\n        .x(d3.scale.ordinal())\n        .xUnits(dc.units.ordinal)\n        .transitionDuration(500)\n        .legend(dc.legend().x(320).y(20).itemHeight(15).gap(5))\n        .margins({ top: 10, right: 100, bottom: 30, left: 30 });\n}\n","undoManager":{"mark":2,"position":3,"stack":[[{"start":{"row":177,"column":31},"end":{"row":177,"column":32},"action":"insert","lines":[" "],"id":2}],[{"start":{"row":177,"column":31},"end":{"row":177,"column":32},"action":"remove","lines":[" "],"id":3}],[{"start":{"row":187,"column":8},"end":{"row":187,"column":32},"action":"remove","lines":[".transitionDuration(500)"],"id":4},{"start":{"row":187,"column":4},"end":{"row":187,"column":8},"action":"remove","lines":["    "]},{"start":{"row":187,"column":0},"end":{"row":187,"column":4},"action":"remove","lines":["    "]},{"start":{"row":186,"column":33},"end":{"row":187,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":186,"column":33},"end":{"row":186,"column":34},"action":"insert","lines":[" "],"id":5}]]},"ace":{"folds":[],"scrolltop":965,"scrollleft":0,"selection":{"start":{"row":186,"column":34},"end":{"row":186,"column":34},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":67,"state":"no_regex","mode":"ace/mode/javascript"}},"timestamp":1573822380498}